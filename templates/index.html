<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Pokemon Chat Assistant</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    
    <!-- Modular CSS Files -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pokemon.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tcg.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="pokedex-lights">
                    <div class="power-light"></div>
                    <div class="indicator-lights">
                        <div class="indicator-light red"></div>
                        <div class="indicator-light yellow"></div>
                        <div class="indicator-light green"></div>
                    </div>
                </div>
                <div class="header-spacer"></div>
                <div class="header-controls">
                    <div class="logo" aria-label="Pokedex brand">
                        <h1>POKEDEX</h1>
                    </div>
                    <div class="header-actions" aria-label="Voice and scan controls">
                        <button id="voiceButton" class="voice-button" aria-label="Start voice conversation" title="Start voice conversation">
                            <svg class="voice-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <line x1="12" y1="19" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <line x1="8" y1="23" x2="16" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <span class="voice-text">Voice</span>
                        </button>
                        <button id="cameraButton" class="camera-button" aria-label="Open camera scanner" title="Scan cards with your camera">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M4 8c0-1.1.9-2 2-2h2l1-1h6l1 1h2c1.1 0 2 .9 2 2v8c0 1.1-.9 2-2 2H6c-1.1 0-2-.9-2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="12" cy="13" r="3" stroke="currentColor" stroke-width="2"/>
                                <path d="M20 6l-2 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <span class="camera-text">Scan</span>
                        </button>
                        <div class="status-indicator" id="statusIndicator">
                            <span class="status-dot"></span>
                            <span class="status-text">Online</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Canvas/Viewport -->
        <div class="main-canvas" id="mainCanvas">
            
            <!-- Pokemon Grid View (Default) -->
            <div class="pokemon-grid-view" id="pokemonGridView">
                <div class="grid-container">
                    <div class="list-wrapper" id="pokemonList">
                        <!-- Pokemon cards will be dynamically loaded here -->
                    </div>
                </div>
                <div id="notFoundMessage" class="not-found-message" style="display: none;">Pokemon not found</div>
            </div>

            <!-- Pokemon Detail View -->
            <div class="pokemon-detail-view" id="pokemonDetailView" style="display: none;">
                <!-- Previous Pokemon Preview -->
                <div class="pokemon-nav-preview pokemon-nav-prev" id="pokemonNavPrev" style="display: none;">
                    <img class="nav-preview-image" src="" alt="Previous Pokemon">
                    <p class="nav-preview-name"></p>
                    <p class="nav-preview-number"></p>
                    <svg class="nav-preview-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                
                <!-- Next Pokemon Preview -->
                <div class="pokemon-nav-preview pokemon-nav-next" id="pokemonNavNext" style="display: none;">
                    <img class="nav-preview-image" src="" alt="Next Pokemon">
                    <p class="nav-preview-name"></p>
                    <p class="nav-preview-number"></p>
                    <svg class="nav-preview-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                
                <div class="detail-header">
                    <div class="pokemon-name-wrap">
                        <h1 class="pokemon-name"></h1>
                        <p class="pokemon-id"></p>
                    </div>
                    <div class="detail-actions">
                        <div class="dropdown-menu-container">
                            <button class="dropdown-toggle-btn" id="pokemonDetailMenuBtn" aria-label="More options">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="1" fill="currentColor"/>
                                    <circle cx="12" cy="5" r="1" fill="currentColor"/>
                                    <circle cx="12" cy="19" r="1" fill="currentColor"/>
                                </svg>
                            </button>
                            <div class="dropdown-menu" id="pokemonDetailDropdown">
                                <button class="dropdown-menu-item" id="forceRefreshPokemon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                        <path d="M23 4v6h-6M1 20v-6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span>Force Refresh from API</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="pokemon-image-section">
                    <img class="pokedex-decoration" src="/static/images/pokedex.svg" alt="">
                    <img class="pokemon-main-image" src="" alt="Pokemon" />
                </div>
                
                <div class="pokemon-info-card">
                    <div class="pokemon-types"></div>
                    
                    <h3 class="section-title">About</h3>
                    <div class="pokemon-basic-info">
                        <div class="info-item">
                            <div class="info-value">
                                <img src="/static/images/weight.svg" alt="Weight" class="info-icon">
                                <span class="pokemon-weight"></span>
                            </div>
                            <p class="info-label">Weight</p>
                        </div>
                        <div class="info-item">
                            <div class="info-value">
                                <img src="/static/images/height.svg" alt="Height" class="info-icon">
                                <span class="pokemon-height"></span>
                            </div>
                            <p class="info-label">Height</p>
                        </div>
                        <div class="info-item">
                            <div class="info-value pokemon-abilities"></div>
                            <p class="info-label">Abilities</p>
                        </div>
                    </div>
                    
                    <p class="pokemon-description"></p>
                    
                    <h3 class="section-title">Base Stats</h3>
                    <div class="pokemon-stats"></div>
                    
                    <div class="pokemon-actions">
                        <div class="action-button-group">
                            <button class="view-cards-btn" id="viewCardsBtn" aria-label="View Trading Cards">
                                <img src="/static/images/tcg-icon.png" alt="TCG" class="tcg-btn-icon">
                                <span>View Trading Cards</span>
                            </button>
                            <button class="action-dropdown-btn" id="viewCardsDropdownBtn" aria-label="More options">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <div class="dropdown-menu" id="viewCardsDropdown">
                                <button class="dropdown-menu-item" id="forceRefreshCards">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                        <path d="M23 4v6h-6M1 20v-6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span>Force Refresh Cards</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TCG Cards View -->
            <div class="tcg-cards-view" id="tcgCardsView" style="display: none;">
                <!-- TCG cards grid will be dynamically populated here -->
            </div>

            <!-- TCG Card Detail View -->
            <div class="tcg-card-detail-view" id="tcgCardDetailView" style="display: none;">
                <!-- TCG card detail will be dynamically populated here -->
            </div>
        </div>

        <!-- Chat Sidebar (Hidden by default) -->
        <div class="chat-sidebar" id="chatSidebar">
            <button class="chat-toggle-btn" id="chatToggleBtn" aria-label="Toggle chat">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="chat-sidebar-content">
                <div class="chat-sidebar-header">
                    <h3>Chat Assistant</h3>
                    <button class="chat-close-btn" id="chatCloseBtn">&times;</button>
                </div>
                <div class="chat-container" id="chatContainer">
                    <!-- Welcome Message -->
                    <div class="welcome-message">
                        <div class="welcome-icon">üëã</div>
                        <h2>Welcome to Pokemon Chat!</h2>
                        <p>Ask me about any Pokemon and I'll provide detailed information with images!</p>
                        <div class="example-queries">
                            <span class="example-chip">Tell me about Pikachu</span>
                            <span class="example-chip">Show me Charizard</span>
                            <span class="example-chip">Show me Pikachu cards</span>
                            <span class="example-chip">Surprise me with a random Pokemon</span>
                        </div>
                    </div>

                    <!-- Messages will be dynamically added here -->
                </div>

                <!-- Input Area (inside sidebar) -->
                <div class="chat-input-container">
                    <div class="input-wrapper">
                        <textarea 
                            id="messageInput" 
                            class="message-input" 
                            placeholder="Ask about a Pokemon..."
                            rows="1"
                        ></textarea>
                        <button id="sendButton" class="send-button" aria-label="Send message">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-action-btn" data-action="help">
                            <span>‚ùì</span> Help
                        </button>
                        <button class="quick-action-btn" data-action="random">
                            <span>üé≤</span> Random
                        </button>
                        <button class="quick-action-btn" data-action="popular">
                            <span>‚≠ê</span> Popular
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Actions Bar -->
        <footer class="pokedex-footer">
            <div class="footer-actions">
                <button class="footer-btn footer-btn-icon-only" id="backBtnFooter" aria-label="Back" data-tooltip="Back">
                    <img
                        src="{{ url_for('static', filename='images/backForwardbutton.svg') }}"
                        alt="Back button"
                        class="footer-btn-icon footer-btn-icon-back"
                    />
                </button>
                
                <button class="footer-btn footer-btn-icon-only" id="forwardBtnFooter" aria-label="Forward" data-tooltip="Forward">
                    <img
                        src="{{ url_for('static', filename='images/backForwardbutton.svg') }}"
                        alt="Forward button"
                        class="footer-btn-icon footer-btn-icon-forward"
                    />
                </button>

                <button class="footer-btn footer-btn-image-only" id="randomPokemonBtn" aria-label="Random Pokemon" data-tooltip="Random">
                    <img
                        src="{{ url_for('static', filename='images/guess-that-pokmon2.png') }}"
                        alt="Who's that Pok√©mon graphic"
                        class="footer-random-img"
                    />
                </button>

                <button class="footer-btn footer-btn-icon-only" id="toolsBtnFooter" aria-label="Settings" data-tooltip="Settings">
                    <img
                        src="{{ url_for('static', filename='images/setting.png') }}"
                        alt="Settings icon"
                        class="footer-setting-icon"
                    />
                </button>

                <button class="footer-btn footer-btn-icon-only" id="helpBtn" aria-label="Help" data-tooltip="Help">
                    <img
                        src="{{ url_for('static', filename='images/slowbro.png') }}"
                        alt="Help icon"
                        class="footer-help-icon"
                    />
                </button>
            </div>
        </footer>

        <!-- Loading Indicator -->
        <div class="loading-indicator" id="loadingIndicator">
            <img src="{{ url_for('static', filename='images/rotomdex.gif') }}" alt="Loading" class="loading-rotom">
            <span>Thinking...</span>
        </div>

        <!-- Help Modal -->
        <div class="help-modal-overlay" id="helpModalOverlay">
            <div class="help-modal">
                <div class="help-modal-header">
                    <h2>üéÆ Pokedex Commands</h2>
                    <button class="help-modal-close" id="helpModalClose">&times;</button>
                </div>
                <div class="help-modal-content">
                    <div class="help-section">
                        <h3>üîç Pokemon Information</h3>
                        <ul>
                            <li><strong>"Tell me about Pikachu"</strong> - Get detailed Pokemon information</li>
                            <li><strong>"Show me Charizard"</strong> - Display Pokemon stats and abilities</li>
                            <li><strong>"What type is Bulbasaur?"</strong> - Get specific Pokemon details</li>
                            <li><strong>"Random Pokemon"</strong> - Discover a random Pokemon</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>üÉè Trading Card Game</h3>
                        <ul>
                            <li><strong>"Show me Pikachu cards"</strong> - Browse TCG cards for a Pokemon</li>
                            <li><strong>"Find rare Charizard cards"</strong> - Search for specific rarities</li>
                            <li><strong>"Show cards from Base Set"</strong> - Filter by set</li>
                            <li><strong>Click any card</strong> - View detailed card info and prices</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>üé§ Voice Commands</h3>
                        <ul>
                            <li><strong>"Back"</strong> - Navigate to previous view</li>
                            <li><strong>"Forward"</strong> - Navigate to next view</li>
                            <li><strong>"Home"</strong> - Return to Pokemon grid</li>
                            <li>Use the Voice button to start/stop voice chat</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>üéØ Quick Tips</h3>
                        <ul>
                            <li>Click the chat icon to toggle the chat sidebar</li>
                            <li>Use the grid to browse all 151 Kanto Pokemon</li>
                            <li>Click any Pokemon card to see detailed stats</li>
                            <li>TCG card modals show market prices from TCGPlayer and Cardmarket</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tools Management Modal -->
        <div class="tools-modal-overlay" id="toolsModalOverlay">
            <div class="tools-modal">
                <div class="tools-modal-header">
                    <h2>‚öôÔ∏è Settings</h2>
                    <button class="tools-modal-close" id="toolsModalClose">&times;</button>
                </div>
                <div class="tools-modal-content" id="toolsModalContent">
                    <!-- Cache Settings Section -->
                    <div class="settings-section">
                        <h3>üíæ Cache Settings</h3>
                        <div class="cache-stats" id="cacheStats">
                            <div class="stat-item">
                                <span class="stat-label">Cache Status:</span>
                                <span class="stat-value" id="cacheStatus">Loading...</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Cached Items:</span>
                                <span class="stat-value" id="cacheFiles">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Cache Size:</span>
                                <span class="stat-value" id="cacheSize">-</span>
                            </div>
                        </div>
                        
                        <div class="cache-controls">
                            <div class="control-row">
                                <label for="cacheToggle" class="control-label">
                                    <span>Enable Cache</span>
                                    <small>Store API responses for faster loading</small>
                                </label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="cacheToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="control-row sub-control">
                                <label for="pokeapiCacheToggle" class="control-label">
                                    <span>Use Cache for Pok√©API</span>
                                    <small>Disable to fetch fresh Pok√©API data every time</small>
                                </label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="pokeapiCacheToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="control-row sub-control">
                                <label for="tcgCacheToggle" class="control-label">
                                    <span>Use Cache for TCG</span>
                                    <small>Disable to fetch fresh Pok√©mon TCG data every time</small>
                                </label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="tcgCacheToggle" checked disabled data-force-disabled="true">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="control-row cache-expiry-row">
                                <div class="control-label">
                                    <span id="cacheExpiryTitle">Cache Expiry: 7 days</span>
                                    <small id="cacheExpiryDescription">Cached data will refresh after this time</small>
                                </div>
                                <div class="cache-slider-wrap">
                                    <input type="range" id="cacheExpiry" min="0" max="90" value="7" class="cache-slider">
                                    <div class="slider-labels">
                                        <span>0</span>
                                        <span>90 days</span>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="cache-clear-btn" id="cacheClearBtn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Clear All Cache
                            </button>
                        </div>
                    </div>

                    <!-- API Access Section -->
                    <div class="settings-section">
                        <h3>üîë API Access</h3>
                        <p class="section-description">
                            Bring your own Azure OpenAI credentials or unlock the built-in defaults with a password. Your choices stay on this device.
                        </p>

                        <div class="api-mode-options" role="radiogroup" aria-label="API credential mode">
                            <label class="api-radio-card">
                                <input type="radio" name="apiMode" value="app" id="apiModeApp">
                                <div class="api-radio-content">
                                    <h4>Use Built-in Credentials</h4>
                                    <p>Protected defaults shipped with the app. Requires access password.</p>
                                </div>
                            </label>
                            <label class="api-radio-card">
                                <input type="radio" name="apiMode" value="custom" id="apiModeCustom">
                                <div class="api-radio-content">
                                    <h4>Use My Own Azure Account</h4>
                                    <p>Provide your own endpoint, key, and deployments.</p>
                                </div>
                            </label>
                        </div>

                        <div class="api-password-panel" id="appPasswordPanel" hidden>
                            <label for="appApiPassword">Enter Access Password</label>
                            <input type="password" id="appApiPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off">
                            <small>This password never leaves this browser unless you choose built-in credentials.</small>
                        </div>

                        <div class="api-custom-fields" id="customApiFields" hidden>
                            <div class="api-fields-grid">
                                <div class="api-field">
                                    <label for="customChatEndpoint">Chat Endpoint URL</label>
                                    <input type="text" id="customChatEndpoint" placeholder="https://YOUR_RESOURCE.openai.azure.com">
                                </div>
                                <div class="api-field">
                                    <label for="customChatKey">Chat API Key</label>
                                    <input type="password" id="customChatKey" placeholder="Paste key">
                                </div>
                                <div class="api-field">
                                    <label for="customChatDeployment">Chat Deployment Name</label>
                                    <input type="text" id="customChatDeployment" placeholder="gpt-4o-mini">
                                </div>
                                <div class="api-field">
                                    <label for="customRealtimeEndpoint">Realtime Endpoint URL</label>
                                    <input type="text" id="customRealtimeEndpoint" placeholder="https://YOUR_RESOURCE.openai.azure.com">
                                </div>
                                <div class="api-field">
                                    <label for="customRealtimeKey">Realtime API Key</label>
                                    <input type="password" id="customRealtimeKey" placeholder="Paste key">
                                </div>
                                <div class="api-field">
                                    <label for="customRealtimeDeployment">Realtime Deployment Name</label>
                                    <input type="text" id="customRealtimeDeployment" placeholder="gpt-4o-realtime-preview">
                                </div>
                                <div class="api-field">
                                    <label for="customRealtimeApiVersion">Realtime API Version</label>
                                    <input type="text" id="customRealtimeApiVersion" placeholder="2024-10-01-preview">
                                </div>
                                <div class="api-field">
                                    <label for="customTcgApiKey">Pokemon TCG API Key</label>
                                    <input type="password" id="customTcgApiKey" placeholder="Paste Pokemon TCG API key">
                                    <small>Used for card searches and TCG price lookups. Get one at pokemontcg.io.</small>
                                </div>
                            </div>
                            <small>Realtime fields are optional if you only use chat. Missing values fall back to chat credentials.</small>
                        </div>

                        <div class="api-actions">
                            <button class="tools-save-btn" id="apiSettingsSaveBtn">Apply API Settings</button>
                            <span class="api-status-text" id="apiSettingsStatus" role="status"></span>
                        </div>
                    </div>
                    
                    <!-- Viewing History Section -->
                    <div class="settings-section">
                        <h3>üëÅÔ∏è Viewing History</h3>
                        <p class="section-description">
                            Track which Pokemon you've viewed. Badge icons appear on the Pokemon grid cards:
                        </p>
                        <div class="viewing-history-legend">
                            <div class="legend-item">
                                <img src="{{ url_for('static', filename='images/pokeballs/pokeball.png') }}" alt="Pokeball" class="legend-icon">
                                <span>Pokeball = Viewed Pokemon details</span>
                            </div>
                            <div class="legend-item">
                                <img src="{{ url_for('static', filename='images/pokeballs/greatball.png') }}" alt="Great Ball" class="legend-icon">
                                <span>Great Ball = Viewed TCG card gallery</span>
                            </div>
                            <div class="legend-item">
                                <img src="{{ url_for('static', filename='images/pokeballs/ultraball.png') }}" alt="Ultra Ball" class="legend-icon">
                                <span>Ultra Ball = Viewed 1 TCG card</span>
                            </div>
                            <div class="legend-item">
                                <img src="{{ url_for('static', filename='images/pokeballs/masterball.png') }}" alt="Master Ball" class="legend-icon">
                                <span>Master Ball = Viewed 2+ TCG cards</span>
                            </div>
                        </div>
                        <div class="cache-controls">
                            <button class="cache-clear-btn" id="clearViewingHistoryBtn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Clear Viewing History
                            </button>
                            <small style="color: var(--text-secondary); margin-top: 0.5rem; display: block;">
                                This data is stored in browser cookies and only visible to you.
                            </small>
                        </div>
                    </div>

                    <!-- Face Identification Section -->
                    <div class="settings-section">
                        <h3>üë§ Face Identification</h3>
                        <p class="section-description">
                            Control the visual overlay that appears when the app is identifying a face. Disabling the overlay keeps identification active but runs quietly in the background.
                        </p>
                        <div class="cache-controls">
                            <div class="control-row">
                                <label for="faceIdOverlayToggle" class="control-label">
                                    <span>Show Face Identification Overlay</span>
                                    <small>Turn off if you prefer background detection without the popup</small>
                                </label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="faceIdOverlayToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="face-profile-capture">
                            <div class="face-profile-video-wrapper">
                                <video id="faceProfileVideo" autoplay playsinline muted></video>
                                <div class="face-profile-overlay" aria-hidden="true">
                                    <div class="face-profile-ring"></div>
                                    <span class="face-profile-hint">Center your face inside the guide</span>
                                </div>
                                <div class="face-profile-status" id="faceProfileStatus">Camera idle. Tap Start Camera to begin.</div>
                            </div>
                            <div class="face-profile-video-actions">
                                <button class="camera-action camera-action-ghost" id="faceProfileStartButton" type="button">Start Camera</button>
                                <button class="camera-action" id="faceProfileCaptureButton" type="button" disabled>Capture Face</button>
                            </div>
                            <div class="face-profile-controls">
                                <div class="camera-prompt face-profile-name-field">
                                    <label for="faceProfileNameInput">Profile Name</label>
                                    <input type="text" id="faceProfileNameInput" placeholder="Enter who you are (e.g. Misty)">
                                </div>
                                <div class="face-profile-preview" id="faceProfilePreviewWrapper" hidden>
                                    <img id="faceProfilePreview" alt="Captured face preview" />
                                    <span>Captured preview</span>
                                </div>
                            </div>
                            <div class="face-profile-actions">
                                <button class="camera-action" id="faceProfileSaveButton" type="button" disabled>Save Profile</button>
                            </div>
                            <p class="face-profile-note">Photos save locally in <code>profiles_pic</code> so the Pok√©dex can recognize you later.</p>
                        </div>
                    </div>

                    <!-- Voice Settings Section -->
                    <div class="settings-section">
                        <h3>üéôÔ∏è Voice Settings</h3>
                        <p class="section-description">
                            Choose which Azure voice the assistant should use during real-time conversations. Changes apply immediately if voice chat is connected.
                        </p>
                        <div class="cache-controls">
                            <div class="control-row">
                                <label for="voiceActorSelect" class="control-label">
                                    <span>Voice Actor</span>
                                    <small>Select the speaking style you prefer</small>
                                </label>
                                <div class="control-input">
                                    <select id="voiceActorSelect" class="settings-select">
                                        <option value="alloy">Alloy ‚Äî Neutral guide (M)</option>
                                        <option value="ash">Ash ‚Äî Warm storyteller (F)</option>
                                        <option value="ballad">Ballad ‚Äî Dramatic narrator (M)</option>
                                        <option value="cedar">Cedar ‚Äî Calm mentor (F)</option>
                                        <option value="coral">Coral ‚Äî Energetic coach (F)</option>
                                        <option value="echo">Echo ‚Äî Crisp announcer (M)</option>
                                        <option value="ember">Ember ‚Äî Radiant performer (F)</option>
                                        <option value="marin">Marin ‚Äî Gentle companion (F)</option>
                                        <option value="luna">Luna ‚Äî Dreamy storyteller (F)</option>
                                        <option value="pearl">Pearl ‚Äî Polished presenter (F)</option>
                                        <option value="sage">Sage ‚Äî Deep announcer (M)</option>
                                        <option value="shimmer">Shimmer ‚Äî Playful host (F)</option>
                                        <option value="sol">Sol ‚Äî Bold hero (M)</option>
                                        <option value="verse">Verse ‚Äî Soft narrator (F)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tools Section -->
                    <div class="settings-section">
                        <h3>üõ†Ô∏è API Tools</h3>
                        <div id="toolsList">
                            <div class="tools-loading">Loading tools...</div>
                        </div>
                    </div>
                </div>
                <div class="tools-modal-footer">
                    <button class="tools-reset-btn" id="toolsResetBtn">Reset Tools to Defaults</button>
                    <button class="tools-save-btn" id="toolsSaveBtn">Save Tool Changes</button>
                </div>
            </div>
        </div>

        <!-- TCG Card Detail Modal -->
        <div class="tcg-card-modal-overlay" id="tcgCardModalOverlay">
            <div class="tcg-card-modal">
                <button class="tcg-card-modal-close" id="tcgCardModalClose">&times;</button>
                <div class="tcg-card-modal-content" id="tcgCardModalContent">
                    <!-- TCG card details will be dynamically loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Camera Scanner Modal -->
        <div class="camera-modal-overlay" id="cameraModalOverlay">
            <div class="camera-modal">
                <div class="camera-modal-header">
                    <div>
                        <h2>Image Scanner</h2>
                        <p class="camera-modal-subtitle">Share a card or poster and get real-time insights.</p>
                    </div>
                    <button class="camera-modal-close" id="cameraModalClose" aria-label="Close camera scanner">&times;</button>
                </div>
                <div class="camera-modal-body">
                    <video id="cameraPreview" autoplay playsinline muted></video>
                    <div class="camera-status-text" id="cameraStatusText">Camera ready. Scanning automatically sends the latest frame for your next question.</div>
                </div>
                <div class="camera-modal-actions">
                    <button class="camera-action camera-action-ghost camera-switch-button" id="cameraSwitchButton" type="button" aria-label="Switch to front camera">
                        <span class="camera-switch-icon">üîÑ</span>
                        <span class="camera-switch-text" id="cameraSwitchText">Use Front Camera</span>
                    </button>
                    <p class="camera-modal-note">Scanning runs the moment this window opens and pauses as soon as you close it.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Load view modules first -->
    <script src="{{ url_for('static', filename='js/views/PokemonGridView.js') }}"></script>
    <script src="{{ url_for('static', filename='js/views/PokemonDetailView.js') }}"></script>
    <script src="{{ url_for('static', filename='js/views/TcgCardsGalleryView.js') }}"></script>
    <script src="{{ url_for('static', filename='js/views/TcgCardDetailView.js') }}"></script>
    
    <!-- Then load core application -->
    <script src="{{ url_for('static', filename='js/realtime-voice.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
